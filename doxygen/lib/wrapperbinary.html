<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Wrapper binary implementation {#page_wrapperbinary} &#8212; ACT 1.2b documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=2bf1fcf8" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_lesson.css?v=e9df6548" />
    <link rel="stylesheet" type="text/css" href="../../_static/term_role_formatting.css?v=4194e21c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom_theme.css" />
    
    <script src="../../_static/documentation_options.js?v=00cc29cc"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=6dbb43f8"></script>
    <script src="../../_static/minipres.js?v=a0d29692"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">ACT 1.2b documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Wrapper binary implementation {#page_wrapperbinary}</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="wrapper-binary-implementation-page-wrapperbinary">
<h1>Wrapper binary implementation {#page_wrapperbinary}<a class="headerlink" href="#wrapper-binary-implementation-page-wrapperbinary" title="Link to this heading">¶</a></h1>
<p>This page mainly describes the implementation of the <code class="docutils literal notranslate"><span class="pre">alexandria</span></code> wrapper binary that is an adapted copy off the <code class="docutils literal notranslate"><span class="pre">gmx</span></code> wrapper in GROMACS.
Many of the details are not visible to most of the code, but this documentation
is included as part of the library API documentation to make it easier to
understand the overall implementation without reading extensive documentation.</p>
<p>======================</p>
<p>The %main() method for the wrapper binary is implemented in
<code class="docutils literal notranslate"><span class="pre">src/act/alexandria/alexandria.cpp</span></code>.  This is a very simple code that does these basic
tasks:</p>
<ol class="arabic simple">
<li><p>Initializes \Gromacs structures using gmx::initForCommandLine()
(see \ref page_usinglibrary).</p></li>
<li><p>Creates a gmx::CommandLineModuleManager instance for the wrapper binary.</p></li>
<li><p>Calls various methods to add modules to the manager and initialize it
otherwise.</p></li>
<li><p>Passes control to the manager (see below).</p></li>
<li><p>On successful return, deinitializes \Gromacs and returns the exit code from
the manager.
The %main() method also catches all exceptions, and if one is caught, prints an
error message and terminates the program cleanly.</p></li>
</ol>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="command-line-modules">
<h1>Command line modules<a class="headerlink" href="#command-line-modules" title="Link to this heading">¶</a></h1>
<p>All modules within the wrapper binary are implemented as classes that implement
the gmx::ICommandLineModule interface.  There is generally some helper
class in between:</p>
<ul class="simple">
<li><p>General C++ modules typically use gmx::Options for their command-line
handling.  Instead of each module implementing parsing and help separately
with identical code, they implement gmx::ICommandLineOptionsModule
instead.  The framework then provides a bridge class that contains the
common code and wraps gmx::ICommandLineOptionsModule into a
gmx::ICommandLineModule.</p></li>
<li><p>For C++ trajectory analysis modules, there is a general implementation for
running the gmx::TrajectoryAnalysisModule subclasses in cmdlinerunner.cpp.</p></li>
<li><p>For old C-style %main() functions, see \ref section_wrapperbinary_cmain.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="command-line-manager-section-wrapperbinary-manager">
<h1>Command line manager {#section_wrapperbinary_manager}<a class="headerlink" href="#command-line-manager-section-wrapperbinary-manager" title="Link to this heading">¶</a></h1>
<p>The core of the wrapper binary is the gmx::CommandLineModuleManager::run()
method.  This method:</p>
<ol class="arabic simple">
<li><p>Parses the command line arguments before the module name as arguments to
the wrapper binary.  Some arguments such as <code class="docutils literal notranslate"><span class="pre">-h</span></code> and <code class="docutils literal notranslate"><span class="pre">-version</span></code> cause rest
of the command (the module name and all that follows) to be ignored.</p></li>
<li><p>If a module is specified, also checks the command line arguments after the
module name for the options understood by the wrapper binary, such as <code class="docutils literal notranslate"><span class="pre">-h</span></code>
and <code class="docutils literal notranslate"><span class="pre">-version</span></code> (see below for details of how <code class="docutils literal notranslate"><span class="pre">-h</span></code> works).  Any such options
are handled by the manager and removed from the command line for further
processing.</p></li>
<li><p>Print the startup header (contents of which can be controlled by the
command line options).</p></li>
<li><p>If a command line option requests termination after the startup header
(such as <code class="docutils literal notranslate"><span class="pre">-version</span></code>), return.</p></li>
<li><p>Passes control to the selected module.  If there is no module specified,
the help module is invoked (see below).</p></li>
<li><p>Print a quote at the end, and return the exit code from the module.</p></li>
</ol>
<section id="command-line-help">
<h2>Command line help<a class="headerlink" href="#command-line-help" title="Link to this heading">¶</a></h2>
<p>To handle the <code class="docutils literal notranslate"><span class="pre">alexandria</span> <span class="pre">help</span> <span class="pre">...</span></code> command, as well as for <code class="docutils literal notranslate"><span class="pre">alexandria</span> <span class="pre">-h</span></code> and for
<code class="docutils literal notranslate"><span class="pre">alexandria</span></code> <em>module</em> <code class="docutils literal notranslate"><span class="pre">-h</span></code>, the command line manager internally creates a module that
handles the <code class="docutils literal notranslate"><span class="pre">help</span></code> command.  All command lines containing the <code class="docutils literal notranslate"><span class="pre">-h</span></code>, as well as
invocation of <code class="docutils literal notranslate"><span class="pre">alexandria</span></code> without any arguments, are translated to corresponding
<code class="docutils literal notranslate"><span class="pre">alexandria</span> <span class="pre">help</span></code> commands.  For example, <code class="docutils literal notranslate"><span class="pre">alexandria</span></code> <em>module</em> <code class="docutils literal notranslate"><span class="pre">-h</span></code> is handled exactly like
<code class="docutils literal notranslate"><span class="pre">alexandria</span> <span class="pre">help</span></code> <em>module</em>.  Note that if <code class="docutils literal notranslate"><span class="pre">-h</span></code> is specified for a module, the command
line manager throws away all the other arguments before passing control to the
module.</p>
<p>After the above translations, the internal help module handles all the help
output.  All the help is organized into a hierarchy of gmx::IHelpTopic
instances.  The help module internally creates a root help topic that is
printed with <code class="docutils literal notranslate"><span class="pre">alexandria</span> <span class="pre">help</span></code>.  If there are additional words after the <code class="docutils literal notranslate"><span class="pre">alexandria</span> <span class="pre">help</span></code>
command, then those are taken to specify the topic to show in the hierarchy.</p>
<p>gmx::CommandLineModuleManager internally creates a help topic for each added
module.  These topics are shown when <code class="docutils literal notranslate"><span class="pre">alexandria</span> <span class="pre">help</span></code> <em>module</em> is invoked.
They forward the request to the actual module (to
gmx::ICommandLineModule::writeHelp()).</p>
<p>In addition to the topics created internally, gmx::CommandLineModuleManager
provides methods to add additional help topics.  Currently, this is used to
expose some reference material for the selections (the same content that is
accessible using <code class="docutils literal notranslate"><span class="pre">help</span></code> in the selection prompt).</p>
</section>
<section id="help-in-other-formats">
<h2>Help in other formats<a class="headerlink" href="#help-in-other-formats" title="Link to this heading">¶</a></h2>
<p>The build system provides a target, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">sphinx-programs</span></code>, that generates
reStructuredText help for the commands, which in turn is used to generate man
and HTML help.  Internally, this executes <code class="docutils literal notranslate"><span class="pre">alexandria</span> <span class="pre">help</span> <span class="pre">-export</span> <span class="pre">rst</span></code>, which
triggers special handling in the internal help module.
See documentation for
\linktodevmanual{build-system,special targets in the build system} for details
of which targets to use for generating the documentation…</p>
<p>If this option is set, the help module loops through all the modules in the
binary, writing help for each into a separate file.  The help module writes
common headers and footers, and asks the actual module to write the
module-specific content (with gmx::ICommandLineModule::writeHelp(),
using a different help context than for console output).</p>
<p>Additionally, a list of all the modules is generated (<code class="docutils literal notranslate"><span class="pre">gromacs.7</span></code> for man
pages, and alphabetical and by-topic lists for the HTML pages).</p>
</section>
<section id="handling-c-main-functions-section-wrapperbinary-cmain">
<h2>Handling C %main() functions {#section_wrapperbinary_cmain}<a class="headerlink" href="#handling-c-main-functions-section-wrapperbinary-cmain" title="Link to this heading">¶</a></h2>
<p>Many pre-5.0 modules are still implemented as a function with a C %main()
signature.  All these binaries call parse_common_args() as more or less the
first thing in their processing.  In order to implement the above approach, the
module manager internally creates a command line module for these (in
gmx::CommandLineModuleManager::addModuleCMain()).  The created module
collaborates with parse_common_args() to achieve the same functionality as for
the new C++ modules.</p>
<p>Running the module simply executes the provided %main() method.
Help writing is more complex, as it requires the help context to be passed from
the module to parse_common_args().  This is handled using a global instance of
the context (see gmx::GlobalCommandLineHelpContext).  This context is set in
the module, and if parse_common_args() detects it, it prints out the help and
returns <code class="docutils literal notranslate"><span class="pre">false</span></code> to indicate to the caller that it should immediately return.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Wrapper binary implementation {#page_wrapperbinary}</a></li>
<li><a class="reference internal" href="#command-line-modules">Command line modules</a></li>
<li><a class="reference internal" href="#command-line-manager-section-wrapperbinary-manager">Command line manager {#section_wrapperbinary_manager}</a><ul>
<li><a class="reference internal" href="#command-line-help">Command line help</a></li>
<li><a class="reference internal" href="#help-in-other-formats">Help in other formats</a></li>
<li><a class="reference internal" href="#handling-c-main-functions-section-wrapperbinary-cmain">Handling C %main() functions {#section_wrapperbinary_cmain}</a></li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/doxygen/lib/wrapperbinary.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">ACT 1.2b documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Wrapper binary implementation {#page_wrapperbinary}</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2026 The Alexandria Chemistry Initiative.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>