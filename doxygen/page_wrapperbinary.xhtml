<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACT: Wrapper binary implementation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACT
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.xhtml');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('page_wrapperbinary.xhtml',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Wrapper binary implementation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_2doxygen_2lib_2wrapperbinary"></a></p>
<p>This page mainly describes the implementation of the <code>alexandria</code> wrapper binary that is an adapted copy off the <code>gmx</code> wrapper in GROMACS. Many of the details are not visible to most of the code, but this documentation is included as part of the library API documentation to make it easier to understand the overall implementation without reading extensive documentation.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
main() implementation</h1>
<p>The main() method for the wrapper binary is implemented in <code>src/act/alexandria/alexandria.cpp</code>. This is a very simple code that does these basic tasks:</p><ol type="1">
<li>Initializes GROMACS structures using gmx::initForCommandLine() (see page_usinglibrary).</li>
<li>Creates a gmx::CommandLineModuleManager instance for the wrapper binary.</li>
<li>Calls various methods to add modules to the manager and initialize it otherwise. <br  />
</li>
<li>Passes control to the manager (see below).</li>
<li>On successful return, deinitializes GROMACS and returns the exit code from the manager. The main() method also catches all exceptions, and if one is caught, prints an error message and terminates the program cleanly.</li>
</ol>
<h1><a class="anchor" id="autotoc_md5"></a>
Command line modules</h1>
<p>All modules within the wrapper binary are implemented as classes that implement the gmx::ICommandLineModule interface. There is generally some helper class in between:</p><ul>
<li>General C++ modules typically use gmx::Options for their command-line handling. Instead of each module implementing parsing and help separately with identical code, they implement gmx::ICommandLineOptionsModule instead. The framework then provides a bridge class that contains the common code and wraps gmx::ICommandLineOptionsModule into a gmx::ICommandLineModule.</li>
<li>For C++ trajectory analysis modules, there is a general implementation for running the gmx::TrajectoryAnalysisModule subclasses in cmdlinerunner.cpp.</li>
<li>For old C-style main() functions, see <a class="el" href="#section_wrapperbinary_cmain">Handling C main() functions</a>.</li>
</ul>
<h1><a class="anchor" id="section_wrapperbinary_manager"></a>
Command line manager</h1>
<p>The core of the wrapper binary is the gmx::CommandLineModuleManager::run() method. This method:</p><ol type="1">
<li>Parses the command line arguments before the module name as arguments to the wrapper binary. Some arguments such as <code>-h</code> and <code>-version</code> cause rest of the command (the module name and all that follows) to be ignored.</li>
<li>If a module is specified, also checks the command line arguments after the module name for the options understood by the wrapper binary, such as <code>-h</code> and <code>-version</code> (see below for details of how <code>-h</code> works). Any such options are handled by the manager and removed from the command line for further processing.</li>
<li>Print the startup header (contents of which can be controlled by the command line options).</li>
<li>If a command line option requests termination after the startup header (such as <code>-version</code>), return.</li>
<li>Passes control to the selected module. If there is no module specified, the help module is invoked (see below).</li>
<li>Print a quote at the end, and return the exit code from the module.</li>
</ol>
<h2><a class="anchor" id="autotoc_md6"></a>
Command line help</h2>
<p>To handle the <code>alexandria help ...</code> command, as well as for <code>alexandria -h</code> and for <code>alexandria</code> <em>module</em> <code>-h</code>, the command line manager internally creates a module that handles the <code>help</code> command. All command lines containing the <code>-h</code>, as well as invocation of <code>alexandria</code> without any arguments, are translated to corresponding <code>alexandria help</code> commands. For example, <code>alexandria</code> <em>module</em> <code>-h</code> is handled exactly like <code>alexandria help</code> <em>module</em>. Note that if <code>-h</code> is specified for a module, the command line manager throws away all the other arguments before passing control to the module.</p>
<p>After the above translations, the internal help module handles all the help output. All the help is organized into a hierarchy of gmx::IHelpTopic instances. The help module internally creates a root help topic that is printed with <code>alexandria help</code>. If there are additional words after the <code>alexandria help</code> command, then those are taken to specify the topic to show in the hierarchy.</p>
<p>gmx::CommandLineModuleManager internally creates a help topic for each added module. These topics are shown when <code>alexandria help</code> <em>module</em> is invoked. They forward the request to the actual module (to gmx::ICommandLineModule::writeHelp()).</p>
<p>In addition to the topics created internally, gmx::CommandLineModuleManager provides methods to add additional help topics. Currently, this is used to expose some reference material for the selections (the same content that is accessible using <code>help</code> in the selection prompt).</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Help in other formats</h2>
<p>The build system provides a target, <code>make sphinx-programs</code>, that generates reStructuredText help for the commands, which in turn is used to generate man and HTML help. Internally, this executes <code>alexandria help -export rst</code>, which triggers special handling in the internal help module. See documentation for <a href="../../dev-manual/build-system.html">special targets in the build system</a> for details of which targets to use for generating the documentation..</p>
<p>If this option is set, the help module loops through all the modules in the binary, writing help for each into a separate file. The help module writes common headers and footers, and asks the actual module to write the module-specific content (with gmx::ICommandLineModule::writeHelp(), using a different help context than for console output).</p>
<p>Additionally, a list of all the modules is generated (<code>gromacs.7</code> for man pages, and alphabetical and by-topic lists for the HTML pages).</p>
<h2><a class="anchor" id="section_wrapperbinary_cmain"></a>
Handling C main() functions</h2>
<p>Many pre-5.0 modules are still implemented as a function with a C main() signature. All these binaries call parse_common_args() as more or less the first thing in their processing. In order to implement the above approach, the module manager internally creates a command line module for these (in gmx::CommandLineModuleManager::addModuleCMain()). The created module collaborates with parse_common_args() to achieve the same functionality as for the new C++ modules.</p>
<p>Running the module simply executes the provided main() method. Help writing is more complex, as it requires the help context to be passed from the module to parse_common_args(). This is handled using a global instance of the context (see gmx::GlobalCommandLineHelpContext). This context is set in the module, and if parse_common_args() detects it, it prints out the help and returns <code>false</code> to indicate to the caller that it should immediately return. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
